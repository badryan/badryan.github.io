<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>On-the-fly GPS visualisation through Node-RED</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4444/2014/04/14/on-the-fly-gps-visualisation-through-node-red.html">
  <link rel="alternate" type="application/rss+xml" title="Opinions &amp; Experiments" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Opinions &amp; Experiments</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/about/">Author</a>
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">On-the-fly GPS visualisation through Node-RED</h1>
    <p class="post-meta">
      <time datetime="2014-04-14T10:22:29+02:00" itemprop="datePublished">
        
        Apr 14, 2014
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><img src="/content/images/2015/09/arfmap.jpg" alt="" /></p>

<p>After I’ve had <a href="https://twitter.com/ceejay">@ceejay</a> and <a href="https://twitter.com/Hardware_Hacks">@hardware_hacks</a> send me code examples for putting geographical coordinates onto <a href="http://www.openstreetmap.org">Open Street Maps</a> or <a href="https://maps.google.com">Google Maps</a>, I feel I should at least publicly document how I’ve gone about it in the end.</p>

<p>I’m receiving JSON sentences through a serial-in node in <a href="http://nodered.org">Node-RED</a>. These are already well formatted an look like <em>{“lat”:”0.18544534″,”lon”:”52.343545″}</em> when I receive them. The serial-in is connected to a websocket-out node. Here I set a path <em>/admin/ws/map</em>, as I’ve learned from code from both CJ and Chris.</p>

<p>Both of them put flags on distinct positions of the map (CJ had sent me code for OSM and Chris for Google Maps). However, for my application, I wanted to express a percentage of data points in a particular perimeter. On the search for a suitable set of <a href="http://leafletjs.com">leaflet.js</a> commands (a framework recommended by CJ), I stumbled across <a href="http://www.patrick-wied.at/static/heatmapjs/">heatmap.js</a>, a framework that does all the hard work for you. In particular, their heatmap object (which can deal with cartesian and geographical coordinates!) has a persistent data store, that is, you can continously push new coordinates into it and it takes care of the relative frequency and visualisation of the same all by itself. In my case, I used the example <em>heatmap.js-master/demo/maps_heatmap_layer/gmaps.html</em>, which one can <a href="https://github.com/pa7/heatmap.js/archive/master.zip">load from Github</a>.</p>

<p>I stripped most of the example and the gist is about 150 lines of well spaced HTML/JavaScript, most of which deals with loading appropriate online and offline libraries (see here for <a href="http://www.patrick-wied.at/static/heatmapjs/example-heatmap-googlemaps.html">an example</a>). Along with yout HTML file, you just need to add two libraries <em>heatmap-gmaps.js</em> and <em>heatmap.js</em> into your web directory. Thanks to CJ and Chris I knew the JavaScript needed to connect from the HTML page to the websocket created in Node-RED. I promised CJ not to share his under-development code, you may want to have a look at Chris’ <a href="http://flows.nodered.org/flow/1aab1d44e387da96b3fe">Node-RED example that he’s put online</a>. In the context of the <em>gmaps.html.</em> The actual “putting a point onto the map” is then just the following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ws.onmessage = function (evt) { try { var data = JSON.parse(evt.data); heatmap.addDataPoint(data.lat,data.lon,1); }
</code></pre>
</div>
<p>and all the magic happens automatically, as shown in the teaser image.</p>


  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">

        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          

          
          <li>
            <a href="https://twitter.com/BorisAdryan"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">BorisAdryan</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Structured and unstructure thoughts. Often IoT-related. Sometimes education-related. By Boris Adryan.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
